<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account | ToyStore</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-bg: #FBEBB5;
            --soft-bg: #FAF4F4;
            --accent-blue: #7091E6;
            --menu-hover: #F9F1E7;
        }

        body { font-family: 'Poppins', sans-serif; color: #000; background-color: #fff; }
        
       
         /* --- NAVIGATION --- */
        .nav-link { font-weight: 600; color: #000 !important; margin: 0 15px; }
        
        .search-input-desktop {
            width: 0; opacity: 0; border: none; border-bottom: 2px solid #000;
            outline: none; transition: all 0.4s ease; padding: 0; background: transparent;
        }

        .search-input-desktop.active { width: 200px; opacity: 1; padding: 0 10px; margin-right: 10px; }

        .search-input-mobile {
            width: 100%; height: 0; opacity: 0; padding: 0; border: none;
            border-bottom: 2px solid #000; transition: all 0.3s ease; outline: none; overflow: hidden;
        }

        .search-input-mobile.active { height: 45px; opacity: 1; padding: 10px 0; margin-top: 15px; }

        /* --- HEADER BANNER --- */
        .page-header {
            background: linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)), 
                        url('https://images.unsplash.com/photo-1537151608828-ea2b11777ee8?auto=format&fit=crop&q=80&w=1200');
            background-size: cover; background-position: center;
            padding: 70px 0; text-align: center;
        }
        .page-header h1 { font-size: 3rem; font-weight: 600; margin-bottom: 5px; }

        /* --- MY ACCOUNT LAYOUT --- */
        .sidebar-menu { padding-right: 30px; }
        .menu-section-title { font-weight: 600; font-size: 1.1rem; margin-top: 25px; margin-bottom: 15px; }
        
        .sidebar-link {
            display: block; padding: 10px 15px; color: #888; text-decoration: none;
            transition: 0.3s; border-radius: 5px; margin-bottom: 5px;
        }
        .sidebar-link:hover, .sidebar-link.active {
            background-color: var(--menu-hover); color: #B88E2F;
        }

        /* --- FORM STYLING --- */
        .profile-card {
            background: #fff; border-radius: 10px; padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .profile-card h3 { color: var(--gold-text); font-weight: 600; margin-bottom: 30px; }
        
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 0.9rem; }
        .form-control-custom {
            width: 100%; padding: 12px 15px; border: 1px solid #D9D9D9;
            border-radius: 5px; margin-bottom: 20px; outline: none;
        }
        
        .btn-save {
            background-color: var(--accent-blue); color: #fff;
            padding: 12px 35px; border: none; border-radius: 5px;
            font-weight: 500; transition: 0.3s;
        }
        .btn-save:hover { background-color: #5b79c7; }
        .btn-cancel { background: transparent; border: none; color: #000; margin-right: 20px; }

        /* --- FEATURES --- */
        .features { background: var(--soft-bg); padding: 80px 0; margin-top: 60px; }
        /* Custom Logout Styling */
.logout-link {
    color: #dc3545 !important; /* Standard Bootstrap Red */
    transition: 0.3s ease;
}

.logout-link:hover {
    background-color: #fff5f5 !important; /* Very light red background */
    color: #a71d2a !important;
}

.sidebar-link i {
    font-size: 1.1rem;
    vertical-align: middle;
}

        /* --- FOOTER --- */
        footer { background: #000; color: #fff; padding: 80px 0 20px; }
        footer a { color: #9F9F9F; display: block; margin-bottom: 12px; text-decoration: none; font-size: 0.9rem; }
        .footer-input { background: transparent; border: none; border-bottom: 1px solid #fff; color: #fff; width: 100%; padding-bottom: 5px; outline: none; }

        @media (max-width: 992px) {
            .sidebar-menu { margin-bottom: 40px; }
            .profile-card { padding: 20px; }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-white py-3">
        <div class="container d-flex align-items-center flex-wrap">
            <button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <a class="navbar-brand ms-2" href="index.html">
                <img src="/Images/logo wings.png" alt="Logo" style="height: 40px;">
            </a>

            <div class="d-flex gap-3 align-items-center ms-auto order-lg-3">
                <a href="#"><i class="bi bi-person fs-5 text-dark"></i></a>
                
                <div class="search-container d-flex align-items-center">
                    <input type="text" id="search-desktop" class="search-input-desktop d-none d-lg-block" placeholder="Search...">
                    <button id="search-trigger" class="btn p-0 border-0 shadow-none">
                        <i class="bi bi-search fs-5 text-dark"></i>
                    </button>
                </div>

                <a href="wishlist.html"><i class="bi bi-heart fs-5 text-dark"></i></a>
                <a href="cart.html"><i class="bi bi-cart fs-5 text-dark"></i></a>
            </div>

            <div class="search-full-width-wrapper w-100 order-4 d-lg-none">
                 <input type="text" id="search-input-mobile" class="search-input-mobile" placeholder="Search toys...">
            </div>

            <div class="collapse navbar-collapse justify-content-center order-lg-2" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="shop.html">Shop</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
          <h1>Welcome, <span id="userName">User</span></h1>
            <p class="text-muted">Home <i class="bi bi-chevron-right mx-2"></i> My Account</p>
        </div>
    </header>

    <main class="container py-5">
        <div class="row">
            <div class="col-lg-3">
    <div class="sidebar-menu">
        <p class="text-muted small">Account Details</p>
        
        <div class="menu-section-title">Manage My Account</div>
        <a href="my-account.html" class="sidebar-link active">My Profile</a>
        <a href="address-book.html" class="sidebar-link">Address Book</a>
        <a href="MyPaymentOption.html" class="sidebar-link">My Payment Options</a>
        
        <div class="menu-section-title">My Orders</div>
        <a href="MyReturns.html" class="sidebar-link">My Returns</a>
        <a href="MyCancellations.html" class="sidebar-link">My Cancellations</a>
        
        <div class="menu-section-title">My Wishlist</div>
        <a href="wishlist.html" class="sidebar-link">My Wishlist</a>

        <div class="menu-section-title mt-4">Account Actions</div>
       <a href="#" id="logoutBtn" class="sidebar-link logout-link">
    <i class="bi bi-box-arrow-right me-2"></i> Logout
</a>

    </div>
</div>
           

            <div class="col-lg-9">
                <div class="profile-card">
                    <h4 class="mb-4 fw-bold" style="color: #000;">Edit Your Profile</h4>
                    
                    <form>
                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>First Name</label>
                               <input type="text" id="firstName" class="form-control-custom">
                               
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Last Name</label>
                                <input type="text" id="lastName" class="form-control-custom">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 form-group">
                                <label>Email</label>
                               <input type="email" id="email" class="form-control-custom">

                            </div>
                            
                        </div>

                       <h5 class="mt-4 mb-3 fw-bold">Change Password</h5>   
                        
                        <div class="form-group">
                            <input type="password" id="currentPassword" class="form-control-custom" placeholder="Current Password">
                           <input type="password" id="newPassword" class="form-control-custom" placeholder="New Password">
                           <input type="password" id="confirmPassword" class="form-control-custom" placeholder="Confirm New Password">
                        </div>
                        <button type="button" id="changePasswordBtn" class="btn-save mt-2">
    Change Password
</button>

                        <div class="d-flex justify-content-end align-items-center mt-4">
                            <button type="button" class="btn-cancel">Cancel</button>
                           <button type="submit" id="saveProfileBtn" class="btn-save"> Save Changes</button>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <section class="features">
        <div class="container">
            <div class="row text-center text-md-start">
                <div class="col-md-4 mb-4">
                    <h3 class="fw-bold">Free Delivery</h3>
                    <p class="text-muted mb-0">For all orders over $50, consectetur adipim scing elit.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h3 class="fw-bold">90 Days Return</h3>
                    <p class="text-muted mb-0">If goods have problems, consectetur adipim scing elit.</p>
                </div>
                <div class="col-md-4">
                    <h3 class="fw-bold">Secure Payment</h3>
                    <p class="text-muted mb-0">100% secure payment, consectetur adipim scing elit.</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="row g-5">
                <div class="col-lg-4">
                    <p style="color: #9F9F9F; line-height: 2;">400 University Drive Suite 200 Coral Gables, <br>FL 33134 USA</p>
                </div>
                <div class="col-lg-2 col-6">
                    <h6 class="mb-4 text-white">Links</h6>
                    <a href="#">Home</a><a href="#">Shop</a><a href="#">About</a><a href="#">Contact</a>
                </div>
                <div class="col-lg-2 col-6">
                    <h6 class="mb-4 text-white">Help</h6>
                    <a href="#">Payment Options</a><a href="#">Returns</a><a href="#">Privacy Policies</a>
                </div>
                <div class="col-lg-4">
                    <h6 class="mb-4 text-white">Newsletter</h6>
                    <div class="d-flex gap-2">
                        <input type="email" class="footer-input" placeholder="Enter Your Email Address">
                        <button class="btn btn-link text-white fw-bold p-0 border-bottom border-white rounded-0">SUBSCRIBE</button>
                    </div>
                </div>
            </div>
            <hr class="mt-5 border-secondary">
            <div class="pt-2 small text-center text-md-start" style="color: #9F9F9F;">
                2022 Meubel House. All rights reserved
            </div>
        </div>
    </footer>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('search-trigger').addEventListener('click', function(e) {
            e.preventDefault();
            if (window.innerWidth < 992) {
                const mobileInput = document.getElementById('search-input-mobile');
                mobileInput.classList.toggle('active');
                if (mobileInput.classList.contains('active')) mobileInput.focus();
            } else {
                const desktopInput = document.getElementById('search-desktop');
                desktopInput.classList.toggle('active');
                if (desktopInput.classList.contains('active')) desktopInput.focus();
            }
        });
    </script>
    <script>
document.getElementById("logoutBtn").addEventListener("click", async (e) => {
    e.preventDefault();

    try {
        await fetch("/api/logout", {
            method: "POST",
            credentials: "include" // üî• VERY IMPORTANT
        });

        // Optional UI cleanup
        localStorage.removeItem("userName");

        // Redirect after logout
        window.location.href = "index.html";
    } catch (err) {
        alert("Logout failed. Please try again.");
    }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    try {
        const res = await fetch("/api/users/me", {
            method: "GET",
            credentials: "include" // VERY IMPORTANT for cookies
        });

        if (!res.ok) {
            // Not logged in
            window.location.href = "login.html";
            return;
        }

        const data = await res.json();
        const user = data.user;

        // Header name
        document.getElementById("userName").innerText = user.fullName || "User";

        // Split name safely
        const nameParts = user.fullName?.split(" ") || [];
        document.getElementById("firstName").value = nameParts[0] || "";
        document.getElementById("lastName").value = nameParts.slice(1).join(" ") || "";

        // Other fields
        document.getElementById("email").value = user.email || "";
        document.getElementById("address").value = user.address || "";

        // Optional localStorage
        localStorage.setItem("userName", user.fullName);

    } catch (error) {
        console.error("Profile load failed", error);
    }
});
</script>
<script>
document.querySelector("form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const firstName = document.getElementById("firstName").value.trim();
    const lastName = document.getElementById("lastName").value.trim();
    const email = document.getElementById("email").value.trim();
   

    try {
        const res = await fetch("/api/users/me", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: "include",
            body: JSON.stringify({
                firstName,
                lastName,
                email,
              
            })
        });

        const data = await res.json();

        if (!res.ok) {
            alert(data.message || "Update failed");
            return;
        }

        // Update UI instantly
        document.getElementById("userName").innerText = data.user.fullName;
        localStorage.setItem("userName", data.user.fullName);

        alert("‚úÖ Profile updated successfully!");

    } catch (error) {
        alert("Something went wrong. Try again.");
    }
});
</script>
<script>
document.getElementById("changePasswordBtn").addEventListener("click", async () => {

    const currentPassword = document.getElementById("currentPassword").value.trim();
    const newPassword = document.getElementById("newPassword").value.trim();
    const confirmPassword = document.getElementById("confirmPassword").value.trim();

    if (!currentPassword || !newPassword || !confirmPassword) {
        alert("Please fill all password fields");
        return;
    }

    if (newPassword !== confirmPassword) {
        alert("New password and confirm password do not match");
        return;
    }

    try {
        const res = await fetch("/api/users/change-password", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: "include",
            body: JSON.stringify({
                currentPassword,
                newPassword,
                confirmPassword
            })
        });

        const data = await res.json();

        if (!res.ok) {
            alert(data.message);
            return;
        }

        alert("üîê Password changed successfully");

        // Clear fields
        document.getElementById("currentPassword").value = "";
        document.getElementById("newPassword").value = "";
        document.getElementById("confirmPassword").value = "";

    } catch (error) {
        alert("Something went wrong. Try again.");
    }
});
</script>

</body>
</html> 